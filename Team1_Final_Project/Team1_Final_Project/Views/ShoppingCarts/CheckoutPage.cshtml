@using Team1_Final_Project.Models.Purchases
@using Team1_Final_Project.Models.Identity
@using Microsoft.AspNet.Identity;

@model Team1_Final_Project.Models.Identity.AppUser


@{
    ViewBag.Title = "CheckoutPage";
    AppDbContext db = new AppDbContext();
    AppUser userLoggedIn = db.Users.Find(User.Identity.GetUserId());
}


<h2>CheckoutPage</h2>

<h3>Songs</h3>

<table class="table">
    <tr>
        <th>
            Song Title
        </th>
        <th>
            Artists
        </th>
        <th>
            Average Rating
        </th>
        <th>
            Price
        </th>
        <th></th>
    </tr>


    @foreach (var item2 in Model.SongsInShoppingCart)
    {
        <tr>
            <td>
                @item2.Song.SongName
            </td>
            <td>
                @item2.Song.SongArtists
            </td>
            <td>
                <!--Ratings -->
            </td>
            <td>
                @item2.Song.SongPrice
            </td>
            <td>
                @Html.ActionLink("Remove Song", "DeleteSong", new { SongID = item2.Song.SongID })
            </td>

        </tr>
    }

</table>

<h3>Albums</h3>

<table class="table">
    <tr>
        <th>
            Album Title
        </th>
        <th>
            Artists
        </th>
        <th>
            Average Rating
        </th>
        <th>
            Price
        </th>
        <th></th>
    </tr>

    @foreach (var item2 in Model.AlbumsInShoppingCart)
    {
        <tr>
            <td>
                @item2.Album.AlbumName
            </td>
            <td>
                @item2.Album.AlbumArtists
            </td>
            <td>
                <!--Ratings -->
            </td>
            <td>
                @item2.Album.AlbumPrice
            </td>
            <td>
                @Html.ActionLink("Remove Album", "DeleteAlbum", new { AlbumID = item2.Album.AlbumID })
            </td>
        </tr>
    }

</table>

<h3>Totals</h3>

@{ 
    decimal Tax = ViewBag.SubTotal * 8.25m;
    decimal GrandTotal = ViewBag.Subtotal + Tax;
}

<table>
    <tr>
        <th>Item</th>
        <th>Amount</th>
    </tr>
    <tr>
        <td><em>Subtotal</em></td>
        <td>@ViewBag.Subtotal</td>
    </tr>
    <tr>
        <td><em>Tax</em></td>
        <td>@Tax</td>
    </tr>
    <tr>
        <td><em>Grand Total</em></td>
        <td>@GrandTotal</td>
    </tr>
</table>

@Html.BeginForm("Checkout", "ShoppingCarts", FormMethod.Post) {
<div class="form-group">
    <div class="form-check">
        <p>Select Credit Card</p>
        @foreach (var card in Model.CreditCards)
        {
            <label class="form-check-label">
                @Html.RadioButton("SelectedCreditCardID", card.CreditCardID, false, new { @class = "form-check-input" }) **** **** **** @card.CreditCardNumber.Substring(-4) @card.CreditCardType.ToString().ToUpper() <br />
            </label>
        }
        @if (userLoggedIn.CreditCards.Count < 2)
        {
            @Html.ActionLink("Add New Credit Card", "AddCreditCard", "CreditCards", null, null)
        }

        <input type="submit" value="Confirm Checkout" />

    </div>
</div>
}



